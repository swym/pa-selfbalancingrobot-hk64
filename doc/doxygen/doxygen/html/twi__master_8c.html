<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>Einpersonen Transportmittel: lib/twi_master.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script src="../../mathjax-2.2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Einpersonen Transportmittel
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Macros</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_97aefd0d527b934f1d99a682da8fe6a9.html">lib</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">twi_master.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;<a class="el" href="twi__master_8h_source.html">twi_master.h</a>&quot;</code><br/>
</div><div class="textblock"><div class="dynheader">
Include dependency graph for twi_master.c:</div>
<div class="dyncontent">
<div class="center"><img src="twi__master_8c__incl.png" border="0" usemap="#lib_2twi__master_8c" alt=""/></div>
<map name="lib_2twi__master_8c" id="lib_2twi__master_8c">
<area shape="rect" id="node2" href="twi__master_8h.html" title="twi_master.h" alt="" coords="193,80,289,107"/></map>
</div>
</div>
<p><a href="twi__master_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ab8b47eb0b53e13c4b34647c2c97388fd"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="twi__master_8c.html#ab8b47eb0b53e13c4b34647c2c97388fd">twi_master_init</a> ()</td></tr>
<tr class="memdesc:ab8b47eb0b53e13c4b34647c2c97388fd"><td class="mdescLeft">&#160;</td><td class="mdescRight">Setup the twi module.  <a href="#ab8b47eb0b53e13c4b34647c2c97388fd">More...</a><br/></td></tr>
<tr class="separator:ab8b47eb0b53e13c4b34647c2c97388fd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a38ff1db93a888454fab7847af2a0f5c7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="twi__master_8c.html#a38ff1db93a888454fab7847af2a0f5c7">twi_send_data</a> (uint8_t slave, uint8_t anz_bytes)</td></tr>
<tr class="memdesc:a38ff1db93a888454fab7847af2a0f5c7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Method to send data to a slave.  <a href="#a38ff1db93a888454fab7847af2a0f5c7">More...</a><br/></td></tr>
<tr class="separator:a38ff1db93a888454fab7847af2a0f5c7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a095a100e547815faf66df46a87968988"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="twi__master_8c.html#a095a100e547815faf66df46a87968988">twi_receive_data</a> (uint8_t slave, uint8_t anz_bytes)</td></tr>
<tr class="memdesc:a095a100e547815faf66df46a87968988"><td class="mdescLeft">&#160;</td><td class="mdescRight">Corresponding to send_data this method receives data the same way.  <a href="#a095a100e547815faf66df46a87968988">More...</a><br/></td></tr>
<tr class="separator:a095a100e547815faf66df46a87968988"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a89bdf8dea79a9e017c3821b6e270c093"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="twi__master_8c.html#a89bdf8dea79a9e017c3821b6e270c093">twi_master_set_ready</a> ()</td></tr>
<tr class="separator:a89bdf8dea79a9e017c3821b6e270c093"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a474f42eedbdc093683fdb4b88be3c48f"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="twi__master_8c.html#a474f42eedbdc093683fdb4b88be3c48f">ISR</a> (TWI_vect)</td></tr>
<tr class="memdesc:a474f42eedbdc093683fdb4b88be3c48f"><td class="mdescLeft">&#160;</td><td class="mdescRight">This Interrupt Service Routine handles all possible status conditions of the TWI hardware.  <a href="#a474f42eedbdc093683fdb4b88be3c48f">More...</a><br/></td></tr>
<tr class="separator:a474f42eedbdc093683fdb4b88be3c48f"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:ae178071b85b716b65d0b856e85534c3b"><td class="memItemLeft" align="right" valign="top">volatile uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="twi__master_8c.html#ae178071b85b716b65d0b856e85534c3b">twi_receive_buffer</a> [<a class="el" href="twi__master_8h.html#a6b20d41d6252e9871430c242cb1a56e7">BUFFER_SIZE</a>]</td></tr>
<tr class="separator:ae178071b85b716b65d0b856e85534c3b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0ebfdf89c2595f09b88e3fa8d5f3ec3b"><td class="memItemLeft" align="right" valign="top">volatile uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="twi__master_8c.html#a0ebfdf89c2595f09b88e3fa8d5f3ec3b">twi_send_buffer</a> [<a class="el" href="twi__master_8h.html#a6b20d41d6252e9871430c242cb1a56e7">BUFFER_SIZE</a>]</td></tr>
<tr class="separator:a0ebfdf89c2595f09b88e3fa8d5f3ec3b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a926e6e50d6c5aca7f59eba912f869ebe"><td class="memItemLeft" align="right" valign="top">volatile uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="twi__master_8c.html#a926e6e50d6c5aca7f59eba912f869ebe">transmitter</a></td></tr>
<tr class="separator:a926e6e50d6c5aca7f59eba912f869ebe"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae92e79ba1068f524ceedbdf8049ef43e"><td class="memItemLeft" align="right" valign="top">volatile uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="twi__master_8c.html#ae92e79ba1068f524ceedbdf8049ef43e">rindx</a></td></tr>
<tr class="separator:ae92e79ba1068f524ceedbdf8049ef43e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac2f9e24d25da5bfdbeb188d3f09e7619"><td class="memItemLeft" align="right" valign="top">volatile uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="twi__master_8c.html#ac2f9e24d25da5bfdbeb188d3f09e7619">sindx</a></td></tr>
<tr class="separator:ac2f9e24d25da5bfdbeb188d3f09e7619"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a72a28732edd60c3bdb789466923678a1"><td class="memItemLeft" align="right" valign="top">volatile uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="twi__master_8c.html#a72a28732edd60c3bdb789466923678a1">number_of_bytes</a></td></tr>
<tr class="separator:a72a28732edd60c3bdb789466923678a1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3dec6baf6b8e19f87fb59089679d3094"><td class="memItemLeft" align="right" valign="top">volatile uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="twi__master_8c.html#a3dec6baf6b8e19f87fb59089679d3094">ready</a></td></tr>
<tr class="separator:a3dec6baf6b8e19f87fb59089679d3094"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2611e342f148c60ff2a7a02415541917"><td class="memItemLeft" align="right" valign="top">volatile uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="twi__master_8c.html#a2611e342f148c60ff2a7a02415541917">sla</a></td></tr>
<tr class="separator:a2611e342f148c60ff2a7a02415541917"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="a474f42eedbdc093683fdb4b88be3c48f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">ISR </td>
          <td>(</td>
          <td class="paramtype">TWI_vect&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This Interrupt Service Routine handles all possible status conditions of the TWI hardware. </p>
<p>Everytime a bus operation has finished, the TWI modules triggers a TWI interrupt. In this case the <a class="el" href="twi__master_8c.html#a474f42eedbdc093683fdb4b88be3c48f" title="This Interrupt Service Routine handles all possible status conditions of the TWI hardware. ">ISR(TWI_vect)</a> is executed. By determing the twi status by reading the TWSR code, we can see in which state of communication we are and take proper actions to continue the transmission.</p>
<p>A more detailed description can be found here: isr_master </p>

<p>Definition at line <a class="el" href="twi__master_8c_source.html#l00176">176</a> of file <a class="el" href="twi__master_8c_source.html">twi_master.c</a>.</p>

<p>References <a class="el" href="twi__master_8c_source.html#l00012">number_of_bytes</a>, <a class="el" href="twi__master_8c_source.html#l00013">ready</a>, <a class="el" href="twi__master_8c_source.html#l00010">rindx</a>, <a class="el" href="twi__master_8c_source.html#l00011">sindx</a>, <a class="el" href="twi__master_8c_source.html#l00014">sla</a>, <a class="el" href="twi__master_8c_source.html#l00009">transmitter</a>, <a class="el" href="twi__master_8c_source.html#l00005">twi_receive_buffer</a>, and <a class="el" href="twi__master_8c_source.html#l00006">twi_send_buffer</a>.</p>

</div>
</div>
<a class="anchor" id="ab8b47eb0b53e13c4b34647c2c97388fd"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void twi_master_init </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Setup the twi module. </p>
<p>This function sets up the twi module for master operation. Therefore we have to write proper values to the following registers:</p>
<ul>
<li>TWBR Two Wire Bitrate Register</li>
<li>TWSR Two Wire Status Register</li>
<li>TWCR Two Wire Control Register </li>
</ul>
<p>TWBR and TWSR are used to configure the bus clock speed. The TWI specifications allows us to choose between two different clock speed modes: one below 100kHz and one up to 400kHz.<br/>
 The following equation shows how to set up the clock speed:</p>
<p>SCL frequency = CPU clock / 16 + 2 * TWBR * (4 ^ TWPS)</p>
<p>According to the equation we choosed TWBR = 18 and TWSR = 1 for 100kHz operations.<br/>
 </p>
<div class="fragment"><div class="line">TWBR = <a class="code" href="twi__master_8h.html#abcb6be311da26987e2942ef57aaf3fb8">TWI_TWBR_VALUE_100</a>;</div>
<div class="line">TWSR &amp;= 0b11111100;</div>
<div class="line">TWSR |= 0x01;</div>
</div><!-- fragment --><p><br/>
 As we can see in this tiny code fragment, the TWPS value is encoded by the two last bits of the TWSR register. </p>

<p>Definition at line <a class="el" href="twi__master_8c_source.html#l00036">36</a> of file <a class="el" href="twi__master_8c_source.html">twi_master.c</a>.</p>

<p>References <a class="el" href="twi__master_8h_source.html#l00002">TWI_TWBR_VALUE_100</a>.</p>

</div>
</div>
<a class="anchor" id="a89bdf8dea79a9e017c3821b6e270c093"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void twi_master_set_ready </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="twi__master_8c_source.html#l00162">162</a> of file <a class="el" href="twi__master_8c_source.html">twi_master.c</a>.</p>

<p>References <a class="el" href="twi__master_8c_source.html#l00013">ready</a>.</p>

<p>Referenced by <a class="el" href="bma020_8c_source.html#l00183">bma020_read_raw_acceleration()</a>.</p>

</div>
</div>
<a class="anchor" id="a095a100e547815faf66df46a87968988"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void twi_receive_data </td>
          <td>(</td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>slave</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>anz_bytes</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Corresponding to send_data this method receives data the same way. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">slave</td><td>contains the slave adress </td></tr>
    <tr><td class="paramname">anz_bytes</td><td>contains the amount of bytes that have to be transmitted</td></tr>
  </table>
  </dd>
</dl>
<p>A global receive_buffer is used to store data that is received by TWI. </p>
<div class="fragment"><div class="line"><span class="keyword">extern</span> <span class="keywordtype">void</span> receive_data(uint8_t slave, uint8_t anz_bytes)</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="twi__master_8c.html#a3dec6baf6b8e19f87fb59089679d3094">ready</a> = FALSE;</div>
<div class="line">    <a class="code" href="twi__master_8c.html#a926e6e50d6c5aca7f59eba912f869ebe">transmitter</a> = FALSE;</div>
<div class="line">    <a class="code" href="twi__master_8c.html#a2611e342f148c60ff2a7a02415541917">sla</a> = slave;</div>
<div class="line">    <a class="code" href="twi__master_8c.html#a72a28732edd60c3bdb789466923678a1">number_of_bytes</a> = anz_bytes;</div>
<div class="line">    <a class="code" href="twi__master_8c.html#ae92e79ba1068f524ceedbdf8049ef43e">rindx</a> = 0;</div>
<div class="line">    TWCR = (1&lt;&lt;TWINT) | (1&lt;&lt;TWSTA) | (1&lt;&lt;TWEN) | (1&lt;&lt;TWIE);</div>
<div class="line">    <span class="keywordflow">while</span>(!<a class="code" href="twi__master_8c.html#a3dec6baf6b8e19f87fb59089679d3094">ready</a>){}</div>
<div class="line">}</div>
</div><!-- fragment --><p> The only differences: <br/>
<b>transmitter</b> is set to FALSE <br/>
Instead of sindex we set rindex to zero. </p>

<p>Definition at line <a class="el" href="twi__master_8c_source.html#l00151">151</a> of file <a class="el" href="twi__master_8c_source.html">twi_master.c</a>.</p>

<p>References <a class="el" href="twi__master_8c_source.html#l00012">number_of_bytes</a>, <a class="el" href="twi__master_8c_source.html#l00013">ready</a>, <a class="el" href="twi__master_8c_source.html#l00010">rindx</a>, <a class="el" href="twi__master_8c_source.html#l00014">sla</a>, and <a class="el" href="twi__master_8c_source.html#l00009">transmitter</a>.</p>

<p>Referenced by <a class="el" href="bma020_8c_source.html#l00183">bma020_read_raw_acceleration()</a>.</p>

</div>
</div>
<a class="anchor" id="a38ff1db93a888454fab7847af2a0f5c7"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void twi_send_data </td>
          <td>(</td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>slave</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>anz_bytes</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Method to send data to a slave. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">slave</td><td>contains the slave adress </td></tr>
    <tr><td class="paramname">anz_bytes</td><td>contains the amount of bytes that have to be transmitted</td></tr>
  </table>
  </dd>
</dl>
<p>The data to be transmitted is stored in the global variable send_buffer. send_buffer[] is an array of uint8_t types. It's size is defined by the constant BUF_SIZE. The declaration of send_buffer is located in the <a class="el" href="twi__master_8h.html">twi_master.h</a> file. </p>
<p>If one wants to transmit data to a slave, he has to write the data to the send_buffer. After calling the send_data() method, all bytes from send_buffer[0] to send_buffer[anz_bytes - 1] will be transmitted to the slave without interruption.</p>
<div class="fragment"><div class="line"><span class="keyword">extern</span> <span class="keywordtype">void</span> send_data(uint8_t slave, uint8_t anz_bytes)</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="twi__master_8c.html#a3dec6baf6b8e19f87fb59089679d3094">ready</a> = <span class="keyword">false</span>;</div>
<div class="line">    <a class="code" href="twi__master_8c.html#a926e6e50d6c5aca7f59eba912f869ebe">transmitter</a> = <span class="keyword">true</span>;</div>
<div class="line">    <a class="code" href="twi__master_8c.html#a2611e342f148c60ff2a7a02415541917">sla</a> = slave;</div>
<div class="line">    <a class="code" href="twi__master_8c.html#a72a28732edd60c3bdb789466923678a1">number_of_bytes</a> = anz_bytes;</div>
<div class="line">    <a class="code" href="twi__master_8c.html#ac2f9e24d25da5bfdbeb188d3f09e7619">sindx</a> = 0;</div>
<div class="line">    TWCR = (1&lt;&lt;TWINT) | (1&lt;&lt;TWSTA) | (1&lt;&lt;TWEN) | (1&lt;&lt;TWIE);</div>
<div class="line">    <span class="keywordflow">while</span>(!<a class="code" href="twi__master_8c.html#a3dec6baf6b8e19f87fb59089679d3094">ready</a>){}</div>
<div class="line">}</div>
</div><!-- fragment --><p> Code explanation in detail: </p>
<div class="fragment"><div class="line"><a class="code" href="twi__master_8c.html#a3dec6baf6b8e19f87fb59089679d3094">ready</a> = <span class="keyword">false</span>;</div>
</div><!-- fragment --><p> The <b>ready</b> variable is used to guarantee, that the whole transmission of every bytes is done without interruption. The program flow within the main method of this master controller is halted until all bytes have been transmitted. </p>
<div class="fragment"><div class="line"><a class="code" href="twi__master_8c.html#a926e6e50d6c5aca7f59eba912f869ebe">transmitter</a> = <span class="keyword">true</span>;</div>
</div><!-- fragment --><p> By setting the variable <b>transmitter</b> to <em>TRUE</em>, the ISR of the master controller can determine wether Master Transmitter or Master Receiver mode is active. </p>
<div class="fragment"><div class="line"><a class="code" href="twi__master_8c.html#a2611e342f148c60ff2a7a02415541917">sla</a> = slave;</div>
</div><!-- fragment --><p> Store the slave adress in the global variable sla to make it visible for the ISR. Same with anz_bytes. </p>
<div class="fragment"><div class="line"><a class="code" href="twi__master_8c.html#ac2f9e24d25da5bfdbeb188d3f09e7619">sindx</a> = 0;</div>
</div><!-- fragment --><p> Set the send_buffer index to zero. </p>
<div class="fragment"><div class="line">TWCR = (1&lt;&lt;TWINT) | (1&lt;&lt;TWSTA) | (1&lt;&lt;TWEN) | (1&lt;&lt;TWIE);</div>
</div><!-- fragment --><p> Here we can see how to manipulate the Two Wire Control Register. <br/>
TWINT causes the TWI to trigger an interrupt so that the ISR executes. <br/>
TWSTA cause the TWI to put a <em> start signal </em> on the TWI bus. All attached slave will recognize the start signal. <br/>
TWEN enables the TWI. <br/>
TWIE Two Wire Interrupt Enable allows the TWI to trigger interrupts. </p>
<div class="fragment"><div class="line"><span class="keywordflow">while</span>(!<a class="code" href="twi__master_8c.html#a3dec6baf6b8e19f87fb59089679d3094">ready</a>){}</div>
<div class="line">The <a class="code" href="twi__master_8c.html#a3dec6baf6b8e19f87fb59089679d3094">ready</a> flag is set within the <a class="code" href="twi__master_8c.html#a474f42eedbdc093683fdb4b88be3c48f">ISR</a> when the TWI reaches an end state that indicates that the transmission</div>
<div class="line">has finished.</div>
</div><!-- fragment --> 
<p>Definition at line <a class="el" href="twi__master_8c_source.html#l00115">115</a> of file <a class="el" href="twi__master_8c_source.html">twi_master.c</a>.</p>

<p>References <a class="el" href="twi__master_8c_source.html#l00012">number_of_bytes</a>, <a class="el" href="twi__master_8c_source.html#l00013">ready</a>, <a class="el" href="twi__master_8c_source.html#l00011">sindx</a>, <a class="el" href="twi__master_8c_source.html#l00014">sla</a>, and <a class="el" href="twi__master_8c_source.html#l00009">transmitter</a>.</p>

<p>Referenced by <a class="el" href="bma020_8c_source.html#l00183">bma020_read_raw_acceleration()</a>.</p>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a class="anchor" id="a72a28732edd60c3bdb789466923678a1"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">volatile uint8_t number_of_bytes</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="twi__master_8c_source.html#l00012">12</a> of file <a class="el" href="twi__master_8c_source.html">twi_master.c</a>.</p>

<p>Referenced by <a class="el" href="twi__master_8c_source.html#l00176">ISR()</a>, <a class="el" href="twi__master_8c_source.html#l00151">twi_receive_data()</a>, and <a class="el" href="twi__master_8c_source.html#l00115">twi_send_data()</a>.</p>

</div>
</div>
<a class="anchor" id="a3dec6baf6b8e19f87fb59089679d3094"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">volatile uint8_t ready</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="twi__master_8c_source.html#l00013">13</a> of file <a class="el" href="twi__master_8c_source.html">twi_master.c</a>.</p>

<p>Referenced by <a class="el" href="twi__master_8c_source.html#l00176">ISR()</a>, <a class="el" href="twi__master_8c_source.html#l00162">twi_master_set_ready()</a>, <a class="el" href="twi__master_8c_source.html#l00151">twi_receive_data()</a>, and <a class="el" href="twi__master_8c_source.html#l00115">twi_send_data()</a>.</p>

</div>
</div>
<a class="anchor" id="ae92e79ba1068f524ceedbdf8049ef43e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">volatile uint8_t rindx</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="twi__master_8c_source.html#l00010">10</a> of file <a class="el" href="twi__master_8c_source.html">twi_master.c</a>.</p>

<p>Referenced by <a class="el" href="twi__master_8c_source.html#l00176">ISR()</a>, and <a class="el" href="twi__master_8c_source.html#l00151">twi_receive_data()</a>.</p>

</div>
</div>
<a class="anchor" id="ac2f9e24d25da5bfdbeb188d3f09e7619"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">volatile uint8_t sindx</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="twi__master_8c_source.html#l00011">11</a> of file <a class="el" href="twi__master_8c_source.html">twi_master.c</a>.</p>

<p>Referenced by <a class="el" href="twi__master_8c_source.html#l00176">ISR()</a>, and <a class="el" href="twi__master_8c_source.html#l00115">twi_send_data()</a>.</p>

</div>
</div>
<a class="anchor" id="a2611e342f148c60ff2a7a02415541917"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">volatile uint8_t sla</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="twi__master_8c_source.html#l00014">14</a> of file <a class="el" href="twi__master_8c_source.html">twi_master.c</a>.</p>

<p>Referenced by <a class="el" href="twi__master_8c_source.html#l00176">ISR()</a>, <a class="el" href="twi__master_8c_source.html#l00151">twi_receive_data()</a>, and <a class="el" href="twi__master_8c_source.html#l00115">twi_send_data()</a>.</p>

</div>
</div>
<a class="anchor" id="a926e6e50d6c5aca7f59eba912f869ebe"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">volatile uint8_t transmitter</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="twi__master_8c_source.html#l00009">9</a> of file <a class="el" href="twi__master_8c_source.html">twi_master.c</a>.</p>

<p>Referenced by <a class="el" href="twi__master_8c_source.html#l00176">ISR()</a>, <a class="el" href="twi__master_8c_source.html#l00151">twi_receive_data()</a>, and <a class="el" href="twi__master_8c_source.html#l00115">twi_send_data()</a>.</p>

</div>
</div>
<a class="anchor" id="ae178071b85b716b65d0b856e85534c3b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">volatile uint8_t twi_receive_buffer[<a class="el" href="twi__master_8h.html#a6b20d41d6252e9871430c242cb1a56e7">BUFFER_SIZE</a>]</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="twi__master_8c_source.html#l00005">5</a> of file <a class="el" href="twi__master_8c_source.html">twi_master.c</a>.</p>

<p>Referenced by <a class="el" href="bma020_8c_source.html#l00183">bma020_read_raw_acceleration()</a>, and <a class="el" href="twi__master_8c_source.html#l00176">ISR()</a>.</p>

</div>
</div>
<a class="anchor" id="a0ebfdf89c2595f09b88e3fa8d5f3ec3b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">volatile uint8_t twi_send_buffer[<a class="el" href="twi__master_8h.html#a6b20d41d6252e9871430c242cb1a56e7">BUFFER_SIZE</a>]</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="twi__master_8c_source.html#l00006">6</a> of file <a class="el" href="twi__master_8c_source.html">twi_master.c</a>.</p>

<p>Referenced by <a class="el" href="bma020_8c_source.html#l00183">bma020_read_raw_acceleration()</a>, and <a class="el" href="twi__master_8c_source.html#l00176">ISR()</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed Nov 6 2013 15:31:59 for Einpersonen Transportmittel by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.5
</small></address>
</body>
</html>
